<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Many Circles Nursery - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <!-- Chart.js Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            direction: rtl;
            min-height: 100vh;
        }
        
        .login-container, .container {
            max-width: 1400px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #34495e;
            margin: 20px 0;
            border-right: 5px solid #3498db;
            padding-right: 15px;
        }
        
        .btn, button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52,152,219,0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        input, select, textarea {
            padding: 12px 15px;
            border-radius: 50px;
            border: 2px solid #e0e0e0;
            margin: 8px;
            width: 100%;
            max-width: 300px;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 10px rgba(52,152,219,0.3);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        th {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            font-size: 16px;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        tr:hover {
            background: #f5f9ff;
        }
        
        .hidden {
            display: none;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 20px;
            margin: 10px;
        }
        
        .chart-container {
            width: 100%;
            max-width: 600px;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 20px;
        }
        
        .search-box {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2ecc71;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            animation: slideDown 0.5s;
            z-index: 9999;
        }
        
        @keyframes slideDown {
            from { top: -100px; }
            to { top: 20px; }
        }
        
        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
    </style>
</head>
<body>
<div id="loginPage" class="login-container">
    <div style="text-align: center; margin-bottom: 30px;">
        <i class="fas fa-child" style="font-size: 80px; color: #3498db;"></i>
        <h1>Many Circles Nursery</h1>
        <p style="color: #7f8c8d;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶Ø§Ù†Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
    </div>
    <div style="max-width: 400px; margin: auto;">
        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value="mostafa">
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="2016">
        <button onclick="login()" style="width: 100%;">Ø¯Ø®ÙˆÙ„ <i class="fas fa-sign-in-alt"></i></button>
    </div>
</div>

<div id="app" class="container hidden">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1><i class="fas fa-school"></i> Many Circles Nursery</h1>
        <div>
            <span style="margin-left: 20px;"><i class="fas fa-user"></i> mostafa</span>
            <button onclick="logout()" class="btn-danger"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div class="grid">
        <button onclick="showPage('addChildPage')" class="btn-success"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø·ÙÙ„</button>
        <button onclick="showPage('attendancePage')"><i class="fas fa-calendar-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
        <button onclick="showPage('statsPage')"><i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        <button onclick="showPage('paymentsPage')"><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</button>
        <button onclick="showPage('childrenListPage')"><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„</button>
        <button onclick="printReport()" class="btn-warning"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ±</button>
    </div>

    <!-- ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø·ÙÙ„ -->
    <div id="addChildPage" class="page">
        <h2><i class="fas fa-child"></i> Ø¥Ø¶Ø§ÙØ© Ø·ÙÙ„ Ø¬Ø¯ÙŠØ¯</h2>
        <div class="card">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap: 15px;">
                <input type="text" id="childName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„ *" required>
                <input type="date" id="birthDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
                <input type="text" id="fatherPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø£Ø¨">
                <input type="text" id="motherPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø£Ù…">
                <input type="text" id="fatherJob" placeholder="Ù…Ù‡Ù†Ø© Ø§Ù„Ø£Ø¨">
                <input type="text" id="motherJob" placeholder="Ù…Ù‡Ù†Ø© Ø§Ù„Ø£Ù…">
                <input type="text" id="classroom" placeholder="Ø§Ù„ÙØµÙ„ *" required>
                <input type="date" id="enrollDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚">
                <textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª / Ø·Ù„Ø¨Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" rows="3"></textarea>
                <input type="number" id="subscriptionFee" placeholder="Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ">
                <input type="number" id="mealsFee" placeholder="Ø§Ù„ÙˆØ¬Ø¨Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <input type="number" id="quranFee" placeholder="Ø§Ù„Ù‚Ø±Ø¢Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="extraActivityName" placeholder="Ø§Ø³Ù… Ù†Ø´Ø§Ø· Ø¥Ø¶Ø§ÙÙŠ">
                    <input type="number" id="extraActivityFee" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                </div>
                <div>
                    <label><i class="fas fa-id-card"></i> ØµÙˆØ±Ø© Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
                    <input type="file" id="birthCert" accept="image/*">
                </div>
                <div>
                    <label><i class="fas fa-camera"></i> ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©:</label>
                    <input type="file" id="childPhoto" accept="image/*">
                </div>
            </div>
            <button onclick="addChild()" style="margin-top: 20px; width: 100%;"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø·ÙÙ„</button>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ (Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù) -->
    <div id="childrenListPage" class="page">
        <h2><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„</h2>
        <div class="search-box">
            <input type="text" id="searchChildren" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø·ÙÙ„..." onkeyup="filterChildren()">
        </div>
        <div class="filters">
            <select id="filterClass" onchange="filterChildren()">
                <option value="">ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„</option>
            </select>
        </div>
        <div id="childrenListContainer"></div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø­Ø¶ÙˆØ± -->
    <div id="attendancePage" class="page">
        <h2><i class="fas fa-calendar-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ - 2026</h2>
        <div class="filters">
            <select id="monthSelect">
                <option>ÙŠÙ†Ø§ÙŠØ±</option><option>ÙØ¨Ø±Ø§ÙŠØ±</option><option>Ù…Ø§Ø±Ø³</option><option>Ø¥Ø¨Ø±ÙŠÙ„</option>
                <option>Ù…Ø§ÙŠÙˆ</option><option>ÙŠÙˆÙ†ÙŠÙˆ</option><option>ÙŠÙˆÙ„ÙŠÙˆ</option><option>Ø£ØºØ³Ø·Ø³</option>
                <option>Ø³Ø¨ØªÙ…Ø¨Ø±</option><option>Ø£ÙƒØªÙˆØ¨Ø±</option><option>Ù†ÙˆÙÙ…Ø¨Ø±</option><option>Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
            </select>
            <select id="filterAttendanceClass" onchange="loadAttendance()">
                <option value="">ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„</option>
            </select>
            <button onclick="loadAttendance()"><i class="fas fa-search"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            <button onclick="markAllPresent()"><i class="fas fa-check-circle"></i> Ø­Ø¶ÙˆØ± Ø§Ù„ÙƒÙ„</button>
            <button onclick="markAllAbsent()"><i class="fas fa-times-circle"></i> ØºÙŠØ§Ø¨ Ø§Ù„ÙƒÙ„</button>
        </div>
        <div id="attendanceTableContainer"></div>
        <button onclick="saveAttendance()" class="btn-success" style="margin-top: 20px;"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div id="statsPage" class="page">
        <h2><i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
        <div class="grid">
            <div class="stats-card">
                <h3><i class="fas fa-users"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø·ÙØ§Ù„</h3>
                <p style="font-size: 3em;" id="totalChildrenCount">0</p>
            </div>
            <div class="stats-card" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                <h3><i class="fas fa-check-circle"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <p style="font-size: 3em;" id="totalPresentCount">0</p>
            </div>
            <div class="stats-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                <h3><i class="fas fa-times-circle"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºÙŠØ§Ø¨</h3>
                <p style="font-size: 3em;" id="totalAbsentCount">0</p>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="attendanceChart"></canvas>
        </div>
        
        <div id="statsContainer"></div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª -->
    <div id="paymentsPage" class="page">
        <h2><i class="fas fa-money-bill"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h2>
        <div class="chart-container">
            <canvas id="paymentsChart"></canvas>
        </div>
        <div id="paymentsContainer"></div>
        <div id="totalPaymentsStats" class="card" style="margin-top: 20px;"></div>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·ÙÙ„ -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h2><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</h2>
        <div id="editFormContent"></div>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
<div id="reportModal" class="modal">
    <div class="modal-content">
        <h2><i class="fas fa-file-alt"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶Ø§Ù†Ø©</h2>
        <div id="reportContent"></div>
        <button onclick="window.print()" class="btn-success"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©</button>
        <button onclick="closeModal('reportModal')" class="btn-danger">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    // ---------- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ----------
    let children = [];
    let attendanceRecords = {};
    let payments = [];
    let attendanceChart, paymentsChart;

    // ---------- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ----------
    function login() {
        let user = document.getElementById('username').value;
        let pass = document.getElementById('password').value;
        if (user === 'mostafa' && pass === '2016') {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            loadFromStorage();
            updateClassFilters();
            showPage('addChildPage');
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
            alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
        }
    }

    function logout() {
        document.getElementById('app').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
    }

    // ---------- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ----------
    function showNotification(message, type = 'success') {
        let notification = document.createElement('div');
        notification.className = 'notification';
        notification.style.background = type === 'success' ? '#2ecc71' : '#e74c3c';
        notification.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${message}`;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    // ---------- Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª ----------
    function showPage(pageId) {
        let pages = document.querySelectorAll('.page');
        pages.forEach(p => p.style.display = 'none');
        document.getElementById(pageId).style.display = 'block';
        
        if (pageId === 'statsPage') {
            renderStats();
            renderAttendanceChart();
        }
        if (pageId === 'paymentsPage') {
            renderPaymentsPage();
            renderPaymentsChart();
        }
        if (pageId === 'childrenListPage') {
            renderChildrenList();
            updateClassFilters();
        }
        if (pageId === 'attendancePage') {
            updateClassFilters();
        }
    }

    // ---------- Ø¥Ø¶Ø§ÙØ© Ø·ÙÙ„ ----------
    function addChild() {
        let name = document.getElementById('childName').value;
        if (!name) {
            showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„', 'error');
            return;
        }

        let child = {
            id: Date.now(),
            name: name,
            birthDate: document.getElementById('birthDate').value,
            fatherPhone: document.getElementById('fatherPhone').value,
            motherPhone: document.getElementById('motherPhone').value,
            fatherJob: document.getElementById('fatherJob').value,
            motherJob: document.getElementById('motherJob').value,
            classroom: document.getElementById('classroom').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
            enrollDate: document.getElementById('enrollDate').value,
            notes: document.getElementById('notes').value,
            subscriptionFee: document.getElementById('subscriptionFee').value || 0,
            mealsFee: document.getElementById('mealsFee').value || 0,
            quranFee: document.getElementById('quranFee').value || 0,
            extraActivityName: document.getElementById('extraActivityName').value,
            extraActivityFee: document.getElementById('extraActivityFee').value || 0,
            birthCert: 'uploaded',
            childPhoto: 'uploaded'
        };
        
        children.push(child);
        saveToStorage();
        clearAddChildForm();
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·ÙÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        updateClassFilters();
    }

    // ---------- Ù…Ø³Ø­ ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© ----------
    function clearAddChildForm() {
        document.getElementById('childName').value = '';
        document.getElementById('birthDate').value = '';
        document.getElementById('fatherPhone').value = '';
        document.getElementById('motherPhone').value = '';
        document.getElementById('fatherJob').value = '';
        document.getElementById('motherJob').value = '';
        document.getElementById('classroom').value = '';
        document.getElementById('enrollDate').value = '';
        document.getElementById('notes').value = '';
        document.getElementById('subscriptionFee').value = '';
        document.getElementById('mealsFee').value = '';
        document.getElementById('quranFee').value = '';
        document.getElementById('extraActivityName').value = '';
        document.getElementById('extraActivityFee').value = '';
    }

    // ---------- ØªØ­Ø¯ÙŠØ« ÙÙ„Ø§ØªØ± Ø§Ù„ÙØµÙˆÙ„ ----------
    function updateClassFilters() {
        let classes = [...new Set(children.map(c => c.classroom))];
        let filter1 = document.getElementById('filterClass');
        let filter2 = document.getElementById('filterAttendanceClass');
        
        if (filter1) {
            filter1.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„</option>';
            classes.forEach(c => {
                filter1.innerHTML += `<option value="${c}">${c}</option>`;
            });
        }
        
        if (filter2) {
            filter2.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„</option>';
            classes.forEach(c => {
                filter2.innerHTML += `<option value="${c}">${c}</option>`;
            });
        }
    }

    // ---------- Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ ----------
    function renderChildrenList() {
        let searchTerm = document.getElementById('searchChildren')?.value.toLowerCase() || '';
        let filterClass = document.getElementById('filterClass')?.value || '';
        
        let filtered = children.filter(child => {
            let matchName = child.name.toLowerCase().includes(searchTerm);
            let matchClass = !filterClass || child.classroom === filterClass;
            return matchName && matchClass;
        });
        
        let sorted = [...filtered].sort((a,b) => a.name.localeCompare(b.name));
        
        let html = `<table>
            <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</th>
                <th>Ø§Ù„ÙØµÙ„</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                <th>Ø±Ù‚Ù… Ø§Ù„Ø£Ø¨</th>
                <th>Ø±Ù‚Ù… Ø§Ù„Ø£Ù…</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>`;
        
        sorted.forEach(child => {
            html += `<tr>
                <td>${child.name}</td>
                <td>${child.classroom}</td>
                <td>${child.birthDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                <td>${child.fatherPhone || '-'}</td>
                <td>${child.motherPhone || '-'}</td>
                <td>
                    <button onclick="openEditModal(${child.id})" class="btn-warning"><i class="fas fa-edit"></i></button>
                    <button onclick="deleteChild(${child.id})" class="btn-danger"><i class="fas fa-trash"></i></button>
                </td>
            </tr>`;
        });
        
        html += `</table>`;
        document.getElementById('childrenListContainer').innerHTML = html;
    }

    // ---------- ÙÙ„ØªØ± Ø§Ù„Ø£Ø·ÙØ§Ù„ ----------
    function filterChildren() {
        renderChildrenList();
    }

    // ---------- ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ----------
    function openEditModal(childId) {
        let child = children.find(c => c.id === childId);
        let form = `
            <div style="display: grid; gap: 15px;">
                <input type="text" id="edit_name" value="${child.name}" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„">
                <input type="date" id="edit_birthDate" value="${child.birthDate || ''}">
                <input type="text" id="edit_fatherPhone" value="${child.fatherPhone || ''}" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø£Ø¨">
                <input type="text" id="edit_motherPhone" value="${child.motherPhone || ''}" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø£Ù…">
                <input type="text" id="edit_classroom" value="${child.classroom}" placeholder="Ø§Ù„ÙØµÙ„">
                <textarea id="edit_notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">${child.notes || ''}</textarea>
                <input type="number" id="edit_subscriptionFee" value="${child.subscriptionFee || 0}" placeholder="Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ">
                <input type="number" id="edit_mealsFee" value="${child.mealsFee || 0}" placeholder="Ø§Ù„ÙˆØ¬Ø¨Ø§Øª">
                <input type="number" id="edit_quranFee" value="${child.quranFee || 0}" placeholder="Ø§Ù„Ù‚Ø±Ø¢Ù†">
                <button onclick="saveEdit(${child.id})" class="btn-success"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                <button onclick="closeModal('editModal')" class="btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        `;
        document.getElementById('editFormContent').innerHTML = form;
        document.getElementById('editModal').style.display = 'flex';
    }

    // ---------- Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ----------
    function saveEdit(childId) {
        let child = children.find(c => c.id === childId);
        child.name = document.getElementById('edit_name').value;
        child.birthDate = document.getElementById('edit_birthDate').value;
        child.fatherPhone = document.getElementById('edit_fatherPhone').value;
        child.motherPhone = document.getElementById('edit_motherPhone').value;
        child.classroom = document.getElementById('edit_classroom').value;
        child.notes = document.getElementById('edit_notes').value;
        child.subscriptionFee = document.getElementById('edit_subscriptionFee').value;
        child.mealsFee = document.getElementById('edit_mealsFee').value;
        child.quranFee = document.getElementById('edit_quranFee').value;
        
        saveToStorage();
        closeModal('editModal');
        renderChildrenList();
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    // ---------- Ø­Ø°Ù Ø·ÙÙ„ ----------
    function deleteChild(childId) {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·ÙÙ„ØŸ')) {
            children = children.filter(c => c.id !== childId);
            
            // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
            for (let key in attendanceRecords) {
                if (key.startsWith(childId)) delete attendanceRecords[key];
            }
            payments = payments.filter(p => p.childId != childId);
            
            saveToStorage();
            renderChildrenList();
            showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·ÙÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    }

    // ---------- Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ----------
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    // ---------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ----------
    function loadAttendance() {
        let month = document.getElementById('monthSelect').value;
        let filterClass = document.getElementById('filterAttendanceClass')?.value || '';
        
        let filteredChildren = children.filter(child => 
            !filterClass || child.classroom === filterClass
        );
        
        let sortedChildren = [...filteredChildren].sort((a,b) => a.name.localeCompare(b.name));
        
        let html = `<table>
            <tr>
                <th>Ø§Ù„ÙØµÙ„</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</th>
                <th>Ø­Ø§Ø¶Ø±</th>
                <th>ØºØ§Ø¦Ø¨</th>
            </tr>`;
        
        sortedChildren.forEach(child => {
            let key = child.id + '_' + month;
            let isPresent = attendanceRecords[key] ? attendanceRecords[key] : 'Ø­Ø§Ø¶Ø±';
            html += `<tr>
                <td>${child.classroom || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                <td>${child.name}</td>
                <td style="text-align: center;">
                    <input type="radio" name="att_${child.id}" value="Ø­Ø§Ø¶Ø±" ${isPresent === 'Ø­Ø§Ø¶Ø±' ? 'checked' : ''} 
                           onclick="setAttendance('${child.id}','${month}','Ø­Ø§Ø¶Ø±')">
                </td>
                <td style="text-align: center;">
                    <input type="radio" name="att_${child.id}" value="ØºØ§Ø¦Ø¨" ${isPresent === 'ØºØ§Ø¦Ø¨' ? 'checked' : ''} 
                           onclick="setAttendance('${child.id}','${month}','ØºØ§Ø¦Ø¨')">
                </td>
            </tr>`;
        });
        
        html += `</table>`;
        document.getElementById('attendanceTableContainer').innerHTML = html;
    }

    function setAttendance(childId, month, status) {
        let key = childId + '_' + month;
        attendanceRecords[key] = status;
        saveToStorage();
    }

    function markAllPresent() {
        let month = document.getElementById('monthSelect').value;
        let radios = document.querySelectorAll('input[type="radio"][value="Ø­Ø§Ø¶Ø±"]');
        radios.forEach(radio => {
            radio.checked = true;
            let childId = radio.name.split('_')[1];
            setAttendance(childId, month, 'Ø­Ø§Ø¶Ø±');
        });
    }

    function markAllAbsent() {
        let month = document.getElementById('monthSelect').value;
        let radios = document.querySelectorAll('input[type="radio"][value="ØºØ§Ø¦Ø¨"]');
        radios.forEach(radio => {
            radio.checked = true;
            let childId = radio.name.split('_')[1];
            setAttendance(childId, month, 'ØºØ§Ø¦Ø¨');
        });
    }

    function saveAttendance() {
        saveToStorage();
        showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    // ---------- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ----------
    function renderStats() {
        let months = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø¥Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
        let stats = {};
        let totalPresent = 0;
        let totalAbsent = 0;
        
        children.forEach(child => {
            stats[child.id] = { name: child.name, present: 0, absent: 0 };
        });
        
        for (let key in attendanceRecords) {
            let [childId, month] = key.split('_');
            if (stats[childId]) {
                if (attendanceRecords[key] === 'Ø­Ø§Ø¶Ø±') {
                    stats[childId].present++;
                    totalPresent++;
                } else if (attendanceRecords[key] === 'ØºØ§Ø¦Ø¨') {
                    stats[childId].absent++;
                    totalAbsent++;
                }
            }
        }
        
        document.getElementById('totalChildrenCount').innerHTML = children.length;
        document.getElementById('totalPresentCount').innerHTML = totalPresent;
        document.getElementById('totalAbsentCount').innerHTML = totalAbsent;
        
        let html = `<table>
            <tr>
                <th>Ø§Ù„Ø·ÙÙ„</th>
                <th>Ø§Ù„ÙØµÙ„</th>
                <th>Ø£ÙŠØ§Ù… Ø­Ø¶ÙˆØ±</th>
                <th>Ø£ÙŠØ§Ù… ØºÙŠØ§Ø¨</th>
                <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
            </tr>`;
        
        Object.values(stats).forEach(s => {
            let child = children.find(c => c.id === parseInt(Object.keys(stats).find(key => stats[key] === s)));
            let total = s.present + s.absent;
            let percentage = total > 0 ? ((s.present / total) * 100).toFixed(1) : 0;
            html += `<tr>
                <td>${s.name}</td>
                <td>${child?.classroom || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                <td style="color: #27ae60; font-weight: bold;">${s.present}</td>
                <td style="color: #e74c3c; font-weight: bold;">${s.absent}</td>
                <td>${percentage}%</td>
            </tr>`;
        });
        
        html += '</table>';
        document.getElementById('statsContainer').innerHTML = html;
    }

    // ---------- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø­Ø¶ÙˆØ± ----------
    function renderAttendanceChart() {
        let ctx = document.getElementById('attendanceChart').getContext('2d');
        
        let stats = {};
        children.forEach(child => {
            stats[child.id] = { present: 0, absent: 0 };
        });
        
        for (let key in attendanceRecords) {
            let [childId] = key.split('_');
            if (stats[childId]) {
                if (attendanceRecords[key] === 'Ø­Ø§Ø¶Ø±') stats[childId].present++;
                else if (attendanceRecords[key] === 'ØºØ§Ø¦Ø¨') stats[childId].absent++;
            }
        }
        
        let presentSum = Object.values(stats).reduce((acc, s) => acc + s.present, 0);
        let absentSum = Object.values(stats).reduce((acc, s) => acc + s.absent, 0);
        
        if (attendanceChart) attendanceChart.destroy();
        
        attendanceChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Ø­Ø¶ÙˆØ±', 'ØºÙŠØ§Ø¨'],
                datasets: [{
                    data: [presentSum, absentSum],
                    backgroundColor: ['#2ecc71', '#e74c3c']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ÙƒÙ„ÙŠØ©'
                    }
                }
            }
        });
    }

    // ---------- Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ----------
    function renderPaymentsPage() {
        let sortedChildren = [...children].sort((a,b) => a.name.localeCompare(b.name));
        let html = `<table>
            <tr>
                <th>Ø§Ù„Ø·ÙÙ„</th>
                <th>Ø§Ù„ÙØµÙ„</th>
                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                <th>Ø­ÙØ¸</th>
            </tr>`;
        
        sortedChildren.forEach(child => {
            html += `<tr>
                <td>${child.name}</td>
                <td>${child.classroom}</td>
                <td><input type="number" id="payAmount_${child.id}" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" style="width: 100px;"></td>
                <td>
                    <select id="payActivity_${child.id}" style="width: 150px;">
                        <option value="Ø§Ø´ØªØ±Ø§Ùƒ">Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ (${child.subscriptionFee || 0} Ø¬Ù†ÙŠÙ‡)</option>
                        <option value="ÙˆØ¬Ø¨Ø§Øª">ÙˆØ¬Ø¨Ø§Øª (${child.mealsFee || 0} Ø¬Ù†ÙŠÙ‡)</option>
                        <option value="Ù‚Ø±Ø¢Ù†">Ù‚Ø±Ø¢Ù† (${child.quranFee || 0} Ø¬Ù†ÙŠÙ‡)</option>
                        ${child.extraActivityName ? `<option value="${child.extraActivityName}">${child.extraActivityName} (${child.extraActivityFee || 0} Ø¬Ù†ÙŠÙ‡)</option>` : ''}
                    </select>
                </td>
                <td>
                    <select id="payMethod_${child.id}">
                        <option value="ÙƒØ§Ø´">ÙƒØ§Ø´</option>
                        <option value="Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</option>
                    </select>
                </td>
                <td><button onclick="recordPayment('${child.id}')" class="btn-success"><i class="fas fa-check"></i></button></td>
            </tr>`;
        });
        
        html += '</table>';
        document.getElementById('paymentsContainer').innerHTML = html;
        renderPaymentStats();
    }

    function recordPayment(childId) {
        let amount = document.getElementById('payAmount_' + childId).value;
        let activity = document.getElementById('payActivity_' + childId).value;
        let method = document.getElementById('payMethod_' + childId).value;
        
        if (!amount || amount <= 0) {
            showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
            return;
        }
        
        let payment = {
            id: Date.now(),
            childId,
            amount: parseFloat(amount),
            activity,
            method,
            date: new Date().toLocaleDateString('ar-EG')
        };
        
        payments.push(payment);
        saveToStorage();
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        renderPaymentsPage();
        renderPaymentsChart();
    }

    function renderPaymentStats() {
        let totalCash = 0, totalOnline = 0, totalAll = 0;
        let activityTotals = {};
        
        payments.forEach(p => {
            totalAll += p.amount;
            if (p.method === 'ÙƒØ§Ø´') totalCash += p.amount;
            else totalOnline += p.amount;
            activityTotals[p.activity] = (activityTotals[p.activity] || 0) + p.amount;
        });
        
        let html = `
            <h3><i class="fas fa-chart-line"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 15px;">
                <div style="background: #3498db; color: white; padding: 20px; border-radius: 15px;">
                    <h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</h4>
                    <p style="font-size: 2em;">${totalAll} Ø¬Ù†ÙŠÙ‡</p>
                </div>
                <div style="background: #2ecc71; color: white; padding: 20px; border-radius: 15px;">
                    <h4>ÙƒØ§Ø´</h4>
                    <p style="font-size: 2em;">${totalCash} Ø¬Ù†ÙŠÙ‡</p>
                </div>
                <div style="background: #f39c12; color: white; padding: 20px; border-radius: 15px;">
                    <h4>Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h4>
                    <p style="font-size: 2em;">${totalOnline} Ø¬Ù†ÙŠÙ‡</p>
                </div>
            </div>
            <h4 style="margin-top: 20px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ù†Ø´Ø§Ø·:</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px,1fr)); gap: 10px;">
        `;
        
        for (let act in activityTotals) {
            html += `<div style="background: #ecf0f1; padding: 15px; border-radius: 10px;">
                        <strong>${act}</strong><br>
                        <span style="font-size: 1.3em; color: #27ae60;">${activityTotals[act]} Ø¬Ù†ÙŠÙ‡</span>
                    </div>`;
        }
        
        html += '</div>';
        
        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
        html += '<h4 style="margin-top: 30px;">Ø¢Ø®Ø± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª:</h4>';
        html += '<table><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø·ÙÙ„</th><th>Ø§Ù„Ù†Ø´Ø§Ø·</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th></tr>';
        
        let recentPayments = [...payments].reverse().slice(0, 10);
        recentPayments.forEach(p => {
            let child = children.find(c => c.id == p.childId);
            html += `<tr>
                <td>${p.date}</td>
                <td>${child?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                <td>${p.activity}</td>
                <td style="color: #27ae60; font-weight: bold;">${p.amount} Ø¬Ù†ÙŠÙ‡</td>
                <td>${p.method}</td>
            </tr>`;
        });
        
        html += '</table>';
        document.getElementById('totalPaymentsStats').innerHTML = html;
    }

    // ---------- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ----------
    function renderPaymentsChart() {
        let ctx = document.getElementById('paymentsChart').getContext('2d');
        
        let methodTotals = { 'ÙƒØ§Ø´': 0, 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†': 0 };
        payments.forEach(p => {
            methodTotals[p.method] += p.amount;
        });
        
        if (paymentsChart) paymentsChart.destroy();
        
        paymentsChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['ÙƒØ§Ø´', 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†'],
                datasets: [{
                    data: [methodTotals['ÙƒØ§Ø´'], methodTotals['Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†']],
                    backgroundColor: ['#2ecc71', '#f39c12']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'ØªÙˆØ²ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹'
                    }
                }
            }
        });
    }

    // ---------- Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± ----------
    function printReport() {
        let html = `
            <div style="padding: 20px;">
                <h1 style="text-align: center;">ØªÙ‚Ø±ÙŠØ± Ø­Ø¶Ø§Ù†Ø© Many Circles</h1>
                <p style="text-align: center;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p>
                
                <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <table border="1" style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø·ÙØ§Ù„</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºÙŠØ§Ø¨</th>
                    </tr>
                    <tr>
                        <td>${children.length}</td>
                        <td>${document.getElementById('totalPresentCount')?.innerHTML || 0}</td>
                        <td>${document.getElementById('totalAbsentCount')?.innerHTML || 0}</td>
                    </tr>
                </table>
                
                <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h2>
                <table border="1" style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</th>
                        <th>ÙƒØ§Ø´</th>
                        <th>Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</th>
                    </tr>
                    <tr>
                        <td>${payments.reduce((acc, p) => acc + p.amount, 0)} Ø¬Ù†ÙŠÙ‡</td>
                        <td>${payments.filter(p => p.method === 'ÙƒØ§Ø´').reduce((acc, p) => acc + p.amount, 0)} Ø¬Ù†ÙŠÙ‡</td>
                        <td>${payments.filter(p => p.method === 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†').reduce((acc, p) => acc + p.amount, 0)} Ø¬Ù†ÙŠÙ‡</td>
                    </tr>
                </table>
            </div>
        `;
        
        document.getElementById('reportContent').innerHTML = html;
        document.getElementById('reportModal').style.display = 'flex';
    }

    // ---------- LocalStorage ----------
    function saveToStorage() {
        localStorage.setItem('manycircles_children', JSON.stringify(children));
        localStorage.setItem('manycircles_attendance', JSON.stringify(attendanceRecords));
        localStorage.setItem('manycircles_payments', JSON.stringify(payments));
    }

    function loadFromStorage() {
        let c = localStorage.getItem('manycircles_children');
        let a = localStorage.getItem('manycircles_attendance');
        let p = localStorage.getItem('manycircles_payments');
        
        if (c) children = JSON.parse(c);
        if (a) attendanceRecords = JSON.parse(a);
        if (p) payments = JSON.parse(p);
    }

    // ---------- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ----------
    window.onload = function() {
        if (localStorage.getItem('manycircles_children')) {
            // Ù„Ùˆ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø©ØŒ Ù†Ø¹Ø±Ø¶ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        }
    };
</script>
</body>
</html>